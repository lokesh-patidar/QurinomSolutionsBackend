<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script defer src="http://localhost:4500/socket.io/socket.io.js"></script>
    <style>
        #message-container .right {
            width: 100%;
            display: flex;
            justify-content: right;
        }

        #message-container .left {
            width: 100%;
            display: flex;
            justify-content: left;
        }
    </style>
</head>

<body>
    <div>
        <h1>Chat Container</h1>
        <div id="message-container">

        </div>
        <div id="send-container">
            <input type="text" id="message" placeholder="enter message" />
            <button id="sendBtn">send</button>
        </div>


        <script src="/socket.io/socket.io.js"></script>
        <script>

            const socket = io('http://localhost:4500');
            const sendBtn = document.getElementById('sendBtn');
            const messageInput = document.getElementById('message');
            const allMessages = document.getElementById('message-container');
            var audio = new Audio('ting.mp3');

            sendBtn.addEventListener('click', () => {
                const message = messageInput.value;
                console.log({ message });
                append(`You ${message}`, 'right');

                // whene ever send message will call it will distribute msg to all in backend with broadcast emit
                socket.emit('sendMessage', message);
                messageInput.value = '';
                audio.play();
            });

            const append = (message, position) => {
                const msgElement = document.createElement('div');
                msgElement.innerText = message;
                msgElement.setAttribute('class', `${position}`);
                allMessages.append(msgElement);
            }

            const name = prompt('Enter Your Name');
            const token = ''
            /// when ever user open chat this should run:-
            socket.emit('newUserJoined', token);

            // as new user will join the backend will emit and broadcast the name and 
            // from here i can appent it to my chat container
            socket.on('user-joined', (name) => {
                append(`${name} joined the chat`, 'left');
            });

            socket.on('receive', (data) => {
                append(`${data.name}: ${data.message}`, 'left');
            });

            socket.on('left', (name) => {
                append(`${name} left the chat`, 'left');
            });

        </script>
    </div>
</body>

</html>